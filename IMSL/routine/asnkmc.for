C   IMSL ROUTINE NAME   - ASNKMC
C
C-----------------------------------------------------------------------
C
C   LATEST REVISION     - NOVEMBER 1, 1979
C
C   PURPOSE             - STUDENT-NEWMAN-KEULS MULTIPLE COMPARISON TEST
C
C   USAGE               - CALL ASNKMC (Y,M,SY,NDF,ALPHA,IR,IW,IER)
C
C   ARGUMENTS    Y      - INPUT VECTOR OF LENGTH M CONTAINING THE
C                           SAMPLE MEANS. Y MUST BE ORDERED SO THAT
C                           Y(I) .LT. Y(I+1) FOR I=1,2,...,M-1.
C                M      - INPUT TOTAL NUMBER OF MEANS UNDER CONSIDER-
C                           ATION. M MUST BE GREATER THAN OR EQUAL TO
C                           2 AND LESS THAN OR EQUAL TO 20.
C                SY     - INPUT ESTIMATE OF EFFECTIVE VARIANCE OF A
C                           SAMPLE MEAN.
C                NDF    - INPUT NUMBER OF DEGREES OF FREEDOM ASSOCIATED
C                           WITH SY. NDF MUST BE GREATER THAN OR
C                           EQUAL TO 5.
C                ALPHA  - INPUT SIGNIFICANCE LEVEL OF THE TEST.
C                           ALPHA MUST BE EITHER .05 OR .01.
C                IR     - OUTPUT VECTOR OF LENGTH M-1 INDICATING
C                           THE SIZE AND LOCATION OF GROUPS OF
C                           OF INDISTINGUISHABLE MEANS.
C                           FOR J POSITIVE, IR(I)=J IMPLIES A GROUP
C                           OF J INDISTINGUISHABLE MEANS BEGINS WITH
C                           MEAN I. J EQUAL TO ZERO IMPLIES NO GROUP
C                           STARTS WITH MEAN I.
C                IW     - VECTOR OF LENGTH M USED AS WORK STORAGE.
C                IER    - ERROR PARAMETER. (OUTPUT)
C                         TERMINAL ERROR
C                           IER=129 INDICATES THAT M, NDF, OR ALPHA WERE
C                             SPECIFIED INCORRECTLY. SEE RESTRICTIONS
C                             ABOVE.
C
C   REQD. IMSL ROUTINES - UERTST,UGETIO
C
C   NOTATION            - INFORMATION ON SPECIAL NOTATION AND
C                           CONVENTIONS IS AVAILABLE IN THE MANUAL
C                           INTRODUCTION OR THROUGH IMSL ROUTINE UHELP
C
C   REMARKS      SY MUST BE AN ESTIMATE OF THE EFFECTIVE VARIANCE OF
C                A SAMPLE MEAN. THIS POINT IS EMPHASIZED SINCE IN SOME
C                MODELS CONTAINING RANDOM COMPONENTS, THE VARIANCE OF
C                THE DIFFERENCE BETWEEN TWO MEANS (HAVING EQUAL
C                VARIANCE) IS NOT TWICE THE VARIANCE OF THE INDIVIDUAL
C                MEANS.
C
C-----------------------------------------------------------------------
C
      SUBROUTINE ASNKMC (Y,M,SY,NDF,ALPHA,IR,IW,IER)
C                                  SPECIFICATIONS FOR ARGUMENTS
      INTEGER            M,NDF,IR(1),IW(M),IER
      REAL               Y(M),SY,ALPHA
C                                  SPECIFICATIONS FOR LOCAL VARIABLES
      INTEGER            I,MM1,K,L,II,JPL,IB,M1,NDF4,INEXT,J,JM1
      REAL               A5(19,22),A1(19,22),
     1                   Z1(19),Z2(19),Z3(19),Z4(19),Z5(19),
     2                   Z6(19),Z7(19),Z8(19),Z9(19),Z10(19),
     3                   Z11(19),Z12(19),Z13(19),Z14(19),Z15(19),
     4                   Z16(19),Z17(19),Z18(19),Z19(19),Z20(19),
     5                   Z21(19),Z22(19),B1(19),B2(19),B3(19),
     6                   B4(19),B5(19),B6(19),B7(19),B8(19),
     7                   B9(19),B10(19),B11(19),B12(19),B13(19),
     8                   B14(19),B15(19),B16(19),B17(19),B18(19),
     9                   B19(19),B20(19),B21(19),B22(19)
      REAL               B,D,DD,SY2,EPS,P05,P01,F24,FP25,FP16,
     1                   F30,F40,FP1,F60,F120,FP016,F500,FP02
      EQUIVALENCE        (A1(1,1),B1(1)),(A1(1,2),B2(1)),
     1                   (A1(1,3),B3(1)),(A1(1,4),B4(1)),
     2                   (A1(1,5),B5(1)),(A1(1,6),B6(1)),
     3                   (A1(1,7),B7(1)),(A1(1,8),B8(1)),
     4                   (A1(1,9),B9(1)),(A1(1,10),B10(1)),
     5                   (A1(1,11),B11(1)),(A1(1,12),B12(1)),
     6                   (A1(1,13),B13(1)),(A1(1,14),B14(1)),
     7                   (A1(1,15),B15(1)),(A1(1,16),B16(1))
      EQUIVALENCE        (A1(1,17),B17(1)),(A1(1,18),B18(1)),
     1                   (A1(1,19),B19(1)),(A1(1,20),B20(1)),
     2                   (A1(1,21),B21(1)),(A1(1,22),B22(1))
      EQUIVALENCE        (A5(1,1),Z1(1)),(A5(1,2),Z2(1)),
     1                   (A5(1,3),Z3(1)),(A5(1,4),Z4(1)),
     2                   (A5(1,5),Z5(1)),(A5(1,6),Z6(1)),
     3                   (A5(1,7),Z7(1)),(A5(1,8),Z8(1)),
     4                   (A5(1,9),Z9(1)),(A5(1,10),Z10(1)),
     5                   (A5(1,11),Z11(1)),(A5(1,12),Z12(1)),
     6                   (A5(1,13),Z13(1)),(A5(1,14),Z14(1)),
     7                   (A5(1,15),Z15(1)),(A5(1,16),Z16(1))
      EQUIVALENCE        (A5(1,17),Z17(1)),(A5(1,18),Z18(1)),
     1                   (A5(1,19),Z19(1)),(A5(1,20),Z20(1)),
     2                   (A5(1,21),Z21(1)),(A5(1,22),Z22(1))
      DATA               Z1/3.64,4.60,5.22,5.67,6.03,6.33,6.58,6.80,
     1                   6.99,7.17,7.32,7.47,7.60,7.72,7.83,7.93,8.03,
     2                   8.12,8.21/
      DATA               Z2/3.46,4.34,4.90,5.31,5.63,5.89,6.12,6.32,
     1                   6.49,6.65,6.79,6.92,7.03,7.14,7.24,7.34,7.43,
     2                   7.51,7.59/
      DATA               Z3/3.34,4.16,4.68,5.06,5.36,5.61,5.82,6.00,
     1                   6.16,6.30,6.43,6.55,6.66,6.76,6.85,6.94,7.02,
     2                   7.09,7.17/
      DATA               Z4/3.26,4.04,4.53,4.89,5.17,5.40,5.60,5.77,
     1                   5.92,6.05,6.18,6.29,6.39,6.48,6.57,6.65,6.73,
     2                   6.80,6.87/
      DATA               Z5/3.20,3.95,4.42,4.76,5.02,5.24,5.43,5.60,
     1                   5.74,5.87,5.98,6.09,6.19,6.28,6.36,6.44,6.51,
     2                   6.58,6.64/
      DATA               Z6/3.15,3.88,4.33,4.65,4.91,5.12,5.30,5.46,
     1                   5.60,5.72,5.83,5.93,6.03,6.11,6.20,6.27,6.34,
     2                   6.40,6.47/
      DATA               Z7/3.11,3.82,4.26,4.57,4.82,5.03,5.20,5.35,
     1                   5.49,5.61,5.71,5.81,5.90,5.99,6.06,6.14,6.20,
     2                   6.26,6.33/
      DATA               Z8/3.08,3.77,4.20,4.51,4.75,4.95,5.12,5.27,
     1                   5.40,5.51,5.62,5.71,5.80,5.88,5.95,6.03,6.09,
     2                   6.15,6.21/
      DATA               Z9/3.06,3.73,4.15,4.45,4.69,4.88,5.05,5.19,
     1                   5.32,5.43,5.53,5.63,5.71,5.79,5.86,5.93,6.00,
     2                   6.05,6.11/
      DATA               Z10/3.03,3.70,4.11,4.41,4.64,4.83,4.99,5.13,
     1                   5.25,5.36,5.46,5.55,5.64,5.72,5.79,5.85,5.92,
     2                   5.97,6.03/
      DATA               Z11/3.01,3.67,4.08,4.37,4.60,4.78,4.94,5.08,
     1                   5.20,5.31,5.40,5.49,5.58,5.65,5.72,5.79,5.85,
     2                   5.90,5.96/
      DATA               Z12/3.00,3.65,4.05,4.33,4.56,4.74,4.90,5.03,
     1                   5.15,5.26,5.35,5.44,5.52,5.59,5.66,5.72,5.79,
     2                   5.84,5.90/
      DATA               Z13/2.98,3.63,4.02,4.30,4.52,4.71,4.86,4.99,
     1                   5.11,5.21,5.31,5.39,5.47,5.55,5.61,5.68,5.74,
     2                   5.79,5.84/
      DATA               Z14/2.97,3.61,4.00,4.28,4.49,4.67,4.82,4.96,
     1                   5.07,5.17,5.27,5.35,5.43,5.50,5.57,5.63,5.69,
     2                   5.74,5.79/
      DATA               Z15/2.96,3.59,3.98,4.25,4.47,4.65,4.79,4.92,
     1                   5.04,5.14,5.23,5.32,5.39,5.46,5.53,5.59,5.65,
     2                   5.70,5.75/
      DATA               Z16/2.95,3.58,3.96,4.23,4.45,4.62,4.77,4.90,
     1                   5.01,5.11,5.20,5.28,5.36,5.43,5.49,5.55,5.61,
     2                   5.66,5.71/
      DATA               Z17/2.92,3.53,3.90,4.17,4.37,4.54,4.68,4.81,
     1                   4.92,5.01,5.10,5.18,5.25,5.32,5.38,5.44,5.50,
     2                   5.54,5.59/
      DATA               Z18/2.89,3.49,3.84,4.10,4.30,4.46,4.60,4.72,
     1                   4.83,4.92,5.00,5.08,5.15,5.21,5.27,5.33,5.38,
     2                   5.43,5.48/
      DATA               Z19/2.86,3.44,3.79,4.04,4.23,4.39,4.52,4.63,
     1                   4.74,4.82,4.91,4.98,5.05,5.11,5.16,5.22,5.27,
     2                   5.31,5.36/
      DATA               Z20/2.83,3.40,3.74,3.98,4.16,4.31,4.44,4.55,
     1                   4.65,4.73,4.81,4.88,4.94,5.00,5.06,5.11,5.16,
     2                   5.20,5.24/
      DATA               Z21/2.80,3.36,3.69,3.92,4.10,4.24,4.36,4.48,
     1                   4.56,4.64,4.72,4.78,4.84,4.90,4.95,5.00,5.05,
     2                   5.09,5.13/
      DATA               Z22/2.77,3.31,3.63,3.86,4.03,4.17,4.29,4.39,
     1                   4.47,4.55,4.62,4.68,4.74,4.80,4.85,4.89,4.93,
     2                   4.97,5.01/
      DATA               B1/5.70,6.97,7.80,8.42,8.91,9.32,9.67,9.97,
     1                   10.24,10.48,10.70,10.89,11.08,11.24,11.40,
     2                   11.55,11.68,11.81,11.93/
      DATA               B2/5.24,6.33,7.03,7.56,7.97,8.32,8.61,8.87,
     1                   9.10,9.30,9.49,9.65,9.81,9.95,10.08,10.21,
     2                   10.32,10.43,10.54/
      DATA               B3/4.95,5.92,6.54,7.01,7.37,7.68,7.94,8.17,
     1                   8.37,8.55,8.71,8.86,9.00,9.12,9.24,9.35,9.46,
     2                   9.55,9.65/
      DATA               B4/4.74,5.63,6.20,6.63,6.96,7.24,7.47,7.68,
     1                   7.87,8.03,8.18,8.31,8.44,8.55,8.66,8.76,8.85,
     2                   8.94,9.03/
      DATA               B5/4.60,5.43,5.96,6.35,6.66,6.91,7.13,7.32,
     1                   7.49,7.65,7.78,7.91,8.03,8.13,8.23,8.32,8.41,
     2                   8.49,8.57/
      DATA               B6/4.48,5.27,5.77,6.14,6.43,6.67,6.87,7.05,
     1                   7.21,7.36,7.48,7.60,7.71,7.81,7.91,7.99,8.07,
     2                   8.15,8.22/
      DATA               B7/4.39,5.14,5.62,5.97,6.25,6.48,6.67,6.84,
     1                   6.99,7.13,7.25,7.36,7.46,7.56,7.65,7.73,7.81,
     2                   7.88,7.95/
      DATA               B8/4.32,5.04,5.50,5.84,6.10,6.32,6.51,6.67,
     1                   6.81,6.94,7.06,7.17,7.26,7.36,7.44,7.52,7.59,
     2                   7.66,7.73/
      DATA               B9/4.26,4.96,5.40,5.73,5.98,6.19,6.37,6.53,
     1                   6.67,6.79,6.90,7.01,7.10,7.19,7.27,7.34,7.42,
     2                   7.48,7.55/
      DATA               B10/4.21,4.89,5.32,5.63,5.88,6.08,6.26,6.41,
     1                   6.54,6.66,6.77,6.87,6.96,7.05,7.12,7.20,7.27,
     2                   7.33,7.39/
      DATA               B11/4.17,4.83,5.25,5.56,5.80,5.99,6.16,6.31,
     1                   6.44,6.55,6.66,6.76,6.84,6.93,7.00,7.07,7.14,
     2                   7.20,7.26/
      DATA               B12/4.13,4.78,5.19,5.49,5.72,5.92,6.08,6.22,
     1                   6.35,6.46,6.56,6.66,6.74,6.82,6.90,6.97,7.03,
     2                   7.09,7.15/
      DATA               B13/4.10,4.74,5.14,5.43,5.66,5.85,6.01,6.15,
     1                   6.27,6.38,6.48,6.57,6.66,6.73,6.80,6.87,6.94,
     2                   7.00,7.05/
      DATA               B14/4.07,4.70,5.09,5.38,5.60,5.79,5.94,6.08,
     1                   6.20,6.31,6.41,6.50,6.58,6.65,6.72,6.79,6.85,
     2                   6.91,6.96/
      DATA               B15/4.05,4.67,5.05,5.33,5.55,5.73,5.89,6.02,
     1                   6.14,6.25,6.34,6.43,6.51,6.58,6.65,6.72,6.78,
     2                   6.84,6.89/
      DATA               B16/4.02,4.64,5.02,5.29,5.51,5.69,5.84,5.97,
     1                   6.09,6.19,6.29,6.37,6.45,6.52,6.59,6.65,6.71,
     2                   6.76,6.82/
      DATA               B17/3.96,4.54,4.91,5.17,5.37,5.54,5.69,5.81,
     1                   5.92,6.02,6.11,6.19,6.26,6.33,6.39,6.45,6.51,
     2                   6.56,6.61/
      DATA               B18/3.89,4.45,4.80,5.05,5.24,5.40,5.54,5.65,
     1                   5.76,5.85,5.93,6.01,6.08,6.14,6.20,6.26,6.31,
     2                   6.36,6.41/
      DATA               B19/3.82,4.37,4.70,4.93,5.11,5.27,5.39,5.50,
     1                   5.60,5.69,5.77,5.84,5.90,5.96,6.02,6.07,6.12,
     2                   6.17,6.21/
      DATA               B20/3.76,4.28,4.60,4.82,4.99,5.13,5.25,5.36,
     1                   5.45,5.53,5.60,5.67,5.73,5.79,5.84,5.89,5.93,
     2                   5.98,6.02/
      DATA               B21/3.70,4.20,4.50,4.71,4.87,5.01,5.12,5.21,
     1                   5.30,5.38,5.44,5.51,5.56,5.61,5.66,5.71,5.75,
     2                   5.79,5.83/
      DATA               B22/3.64,4.12,4.40,4.60,4.76,4.88,4.99,5.08,
     1                   5.16,5.23,5.29,5.35,5.40,5.45,5.49,5.54,5.57,
     2                   5.61,5.65/
      DATA               P05/.05/,P01/.01/,EPS/.00001/,F24/24./,
     1                   FP25/.25/,F30/30./,F40/40./,FP1/.1/,
     2                   F60/60./,F120/120./,F500/500./
      DATA               FP16/.1666667/
      DATA               FP016/.1666667E-1/
      DATA               FP02/.2631550E-2/
C                                  FIRST EXECUTABLE STATEMENT
      IER = 0
      IB = 0
C                                  TERMINAL ERROR - INCORRECT INPUT
      IF(ABS(ALPHA-P05).GE.EPS .AND. ABS(ALPHA-P01).GE.EPS) GO TO 130
      IF (NDF .LT. 5) GO TO 130
      IF (M .LT. 2 .OR. M .GT. 20) GO TO 130
      MM1 = M-1
      DO 10 I = 1,MM1
         IR(I) = 0
         IW(I) = 0
   10 CONTINUE
      IW(M) = 0
      M1 = M+1
      NDF4 = NDF-4
      IF (NDF .LE. 20) GO TO 95
C                                  INTERPOLATION IS REQUIRED
      IF (NDF-30) 20,15,40
   15 NDF4 = 18
      GO TO 95
   20 IF (NDF-24) 30,25,35
   25 NDF4 = 17
      GO TO 95
   30 IB = 16
      INEXT = 17
      D = (F24-NDF)*FP25
      GO TO 95
   35 IB = 17
      INEXT = 18
      D = (F30-NDF)*FP16
      GO TO 95
   40 IF (NDF-60) 50,45,70
   45 NDF4 = 20
      GO TO 95
   50 IF (NDF-40) 60,55,65
   55 NDF4 = 19
      GO TO 95
   60 IB = 18
      INEXT = 19
      D = (F40-NDF)*FP1
      GO TO 95
   65 IB = 19
      INEXT = 20
      D = (F60-NDF)*P05
      GO TO 95
   70 IF (NDF - 120) 80,75,85
   75 NDF4 = 21
      GO TO 95
   80 IB = 20
      INEXT = 21
      D = (F120-NDF)*FP016
      GO TO 95
   85 IF (NDF .GE. 500) GO TO 90
      IB = 21
      INEXT = 22
      D = (F500-NDF)*FP02
      GO TO 95
   90 NDF4 = 22
   95 SY2 = SQRT(SY)
      DO 125 I = 1,MM1
         J = M1-I
         L = 1
         JM1 = J-1
C                                  K GROUPS OF LENGTH J ARE UNDER
C                                  CONSIDERATION
C                                  FIND APPROPRIATE Q VALUE
         IF (IB .EQ. 0) GO TO 100
C                                  INTERPOLATION
         IF (ABS(ALPHA-P01).LT.EPS) DD = D*(A1(JM1,IB)-A1(JM1,INEXT))+
     1      A1(JM1,INEXT)
         IF (ABS(ALPHA-P05).LT.EPS) DD = D*(A5(JM1,IB)-A5(JM1,INEXT))+
     1      A5(JM1,INEXT)
         B = SY2*DD
         GO TO 105
  100    IF (ABS(ALPHA-P01).LT.EPS) B = SY2*A1(JM1,NDF4)
         IF (ABS(ALPHA-P05).LT.EPS) B = SY2*A5(JM1,NDF4)
  105    DO 120 K = 1,I
            JPL = L+JM1
            IF (IW(L)+IW(JPL) .GT. 1) GO TO 115
            IF (Y(JPL)-Y(L) .GT. B) GO TO 115
            IR(L) = J
            DO 110 II = L,JPL
               IW(II) = 1
  110       CONTINUE
  115       L = L+1
  120    CONTINUE
  125 CONTINUE
      GO TO 9005
  130 IER = 129
 9000 CONTINUE
      CALL UERTST (IER,'ASNKMC')
 9005 RETURN
      END
